import{A as D,s as S,c as L,z as P,u as F,B as N,d as R,f as y,h as i,r as t,a as A,o as _,w as l,j as d,i as E,y as M,x as o,e as j,k as V,t as z,C as T}from"./index-gNg7DZr4.js";import{a as W,B}from"./api-CywMSbo_.js";function q(){const w=F(),s=N(),{setAuth:p}=D(),e=S({login:"",password:"",visiblePassword:!1,loading:!1,errors:{general:"",login:"",password:""}}),m=L(()=>!!e.value.login.trim()&&!!e.value.password.trim()&&!e.value.loading),b=()=>{e.value.errors.general="",e.value.errors.login="",e.value.errors.password=""},k=S(),a=()=>P(()=>{k.value?.$el?.querySelector("input")?.focus()}),x=r=>{const n=r.response,c="Ошибка авторизации";if(n?.status===401&&n.data?.error){const{error:g,message:v}=n.data;["user_not_found","user_cold"].includes(g)?(e.value.errors.login=v||c,a()):g==="invalid_password"?e.value.errors.password=v||c:e.value.errors.general=c}else e.value.errors.general=c};return{state:e,canSubmit:m,loginFieldRef:k,onLogin:async()=>{if(m.value){b(),e.value.loading=!0;try{const{data:r}=await W.post("/mobile/login",{login:e.value.login.trim(),password:e.value.password.trim()});if(r?.success&&r?.token&&r?.user){p(r.token,r.user);const n=s.query.redirect||{name:"main"};await w.replace(n)}else throw new Error("Некорректный ответ авторизации")}catch(r){x(r)}finally{e.value.loading=!1}}},loginWithMockData:()=>{p("mock-token-123",{login:"testuser",fullName:"Иванов Иван Иванович",email:"ivanov.ii@company.com",department:"Отдел разработки",position:"Старший разработчик",phone:"+7 (999) 123-45-67"}),w.replace({name:"main"})},focusLogin:a}}const U={class:"d-flex justify-center mb-5"},O=R({__name:"LoginPage",setup(w){const{state:s,canSubmit:p,loginFieldRef:e,onLogin:m,loginWithMockData:b}=q();return(k,a)=>{const x=t("v-img"),C=t("v-alert"),h=t("v-btn"),r=t("v-divider"),n=t("v-form"),c=t("v-card-text"),g=t("v-card"),v=t("v-container"),u=A("motion");return _(),y(v,{class:"fill-height d-flex align-center justify-center py-8"},{default:i(()=>[l(d(g,{width:"310",class:"glossy pa-9",elevation:"8",style:{"border-radius":"var(--radius-lg)"}},{default:i(()=>[d(c,{class:"pa-0"},{default:i(()=>[E("div",U,[l(d(x,{src:"/src/assets/images/ui/lcg-logo.png",class:"my-5",initial:{opacity:0,scale:.8,y:-20},enter:{opacity:1,scale:1,y:0,transition:{type:"spring",stiffness:150,damping:15,duration:1200}}},null,512),[[u]])]),d(n,{autocomplete:"on",onSubmit:M(o(m),["prevent"])},{default:i(()=>[l(d(B,{ref_key:"loginFieldRef",ref:e,modelValue:o(s).login,"onUpdate:modelValue":a[0]||(a[0]=f=>o(s).login=f),placeholder:"Логин",class:"mb-5",autocomplete:"username",name:"username",autofocus:"","prepend-inner-icon":"mdi-account","error-messages":o(s).errors.login,initial:{opacity:0},enter:{opacity:1,transition:{duration:600,delay:200}}},null,8,["modelValue","error-messages"]),[[u]]),l(d(B,{modelValue:o(s).password,"onUpdate:modelValue":a[1]||(a[1]=f=>o(s).password=f),placeholder:"Пароль",class:"mb-5",name:"current-password",autocomplete:"current-password",type:o(s).visiblePassword?"text":"password","append-inner-icon":o(s).visiblePassword?"mdi-eye-off":"mdi-eye","error-messages":o(s).errors.password,"onClick:appendInner":a[2]||(a[2]=f=>o(s).visiblePassword=!o(s).visiblePassword),initial:{opacity:0},enter:{opacity:1,transition:{duration:600,delay:300}}},null,8,["modelValue","type","append-inner-icon","error-messages"]),[[u]]),o(s).errors.general?l((_(),y(C,{key:0,type:"error",variant:"tonal",density:"compact",class:"mb-5 glossy rounded-base-md",initial:{opacity:0,scale:.9},enter:{opacity:1,scale:1,transition:{type:"spring",stiffness:300,damping:20,duration:400}}},{default:i(()=>[V(z(o(s).errors.general),1)]),_:1})),[[u]]):j("",!0),l((_(),y(h,{type:"submit",color:"primary",size:"large",block:"",class:"glossy",loading:o(s).loading,disabled:!o(p),style:{"border-radius":"var(--radius-md)"},initial:{opacity:0},enter:{opacity:1,transition:{duration:400}}},{default:i(()=>[...a[3]||(a[3]=[V(" Войти ",-1)])]),_:1},8,["loading","disabled"])),[[u]]),d(r,{class:"my-4"}),l((_(),y(h,{variant:"outlined",color:"secondary",size:"large",block:"",class:"glossy",onClick:o(b),style:{"border-radius":"var(--radius-md)"},initial:{opacity:0},enter:{opacity:1,transition:{duration:400}}},{default:i(()=>[...a[4]||(a[4]=[V(" Войти (тест) ",-1)])]),_:1},8,["onClick"])),[[u]])]),_:1},8,["onSubmit"])]),_:1})]),_:1},512),[[T,!0]])]),_:1})}}});export{O as default};
